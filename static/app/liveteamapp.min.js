function isSerializedDate(e){return e&&typeof e!="object"}var xplive={};xplive.AppName="LiveTeamApp",xplive.Tasks||(xplive.Tasks={}),xplive.Interactors||(xplive.Interactors={}),xplive.Common||(xplive.Common={}),xplive.Events||(xplive.Events={}),xplive.DataBinders||(xplive.DataBinders={}),xplive.Storage||(xplive.Storage={}),xplive.Widgets||(xplive.Widgets={}),xplive.Services||(xplive.Services={}),xplive.UItext||(xplive.UItext={}),xplive.Chat||(xplive.Chat={}),xplive.Status={RUNNING:"Running",STOPPED:"Stopped",FINISHED:"Finished"},xplive.Actions={STOP:"Stop",RESUME:"Resume"},xplive.Kinds={PLANIFIED:"Planned",UNEXPECTED:"Unexpected"},xplive.Styles={taskStarter:{cssClass:"taskStarter"},disabled:"disabled",runningStatus:"runningStatusCls",unexpectedRunningStatus:"unexpectedRunningStatusCls",stoppedStatus:"stoppedStatusCls",stopActionCss:"stop",taskOnCss:"taskOn",taskOffCss:"taskOff",memberOnPomodoro:"btn btn-danger",memberAvailable:"btn btn-info",memberOffline:"btn offline",memberIsTakingBreak:"btn btn-warning",memberDetails:"modal hide fade in",memberIsMyself:"myself",severalSessionsOpenWithSameAccount:"btn btn-inverse"},sOn.Widgets.Table.clickableClass="btn clickableCell",sOn.Widgets.Table.removeIconClass="actionCell removeRowIcon",xplive.SessionManager=function(){this.locationGetter={path:function(){return window.location.pathname},host:function(){return window.location.protocol+"//"+window.location.host}},this.browserSession=function(){var e=this.locationGetter.path();e=decodeURI(e),e=e.replace(/ /g,"");var t=e.split("/");return{team:t[1],username:t[2],host:this.locationGetter.host()}}},xplive.Common.MaximunTeamInactivity=432e5,xplive.Common.MaximunMissingMateUpdatesToConsiderOffline=20,xplive.Common.ActivityIsSentAtLeast=7,xplive.Common.InteractWithTeamEvery=2500,xplive.Common.TimeToConsiderInactivity=4e4,xplive.Common.ChatServerAddress="xplive-chat.herokuapp.com:80",xplive.Events.iHaveChangedMyActivity="I have changed my activity",xplive.Events.iAmDoingTheSameThing="My activity hasnt changed",xplive.Events.iAmUpdatingMyMatesActivity="I am updating my mate activity",xplive.Events.thereIsNewTeamActivity="There is new team activity",xplive.Events.thereIsNewMateActivity="There is new mate activity",xplive.Events.userIsNotInteractingWithWindow="User is not interacting with the window",xplive.Events.userIsActiveAgain="User is active again",xplive.Events.itIsTimeToReviewMyActivity="It is time to review my activity",xplive.Events.onShowMateInfo="OnShowMateInfo",xplive.Events.windowIsVisible="windowIsVisible",xplive.Events.windowIsNotVisible="windowIsNotVisible",xplive.Events.newPomodoroStarted="newPomodoroStarted",xplive.Events.pomodoroChanged="onPomodoroChanged",xplive.Events.pomodoroFinished="pomodoroFinished",xplive.Common.Duration=function(e){var t=this;this.delta=e||0,this.seconds=function(){return(new Date(this.delta)).getUTCSeconds()},this.minutes=function(){return(new Date(this.delta)).getUTCMinutes()},this.hours=function(){return(new Date(this.delta)).getUTCHours()},this.toString=function(){var e=this.hours();return e>0?this.hours()+"h: "+n():n()};var n=function(){return t.minutes()+"m: "+t.seconds()+"s "};this.increase=function(e){t.delta+=e}},xplive.Common.TimeDeltaCalculator=function(){this.timeDelta=function(e,t){var n=t;return t||(n=new Date),n-e}},xplive.Common.ExecAsync=function(e,t){setTimeout(function(){e()},t)},xplive.Widgets=xplive.Widgets||{},xplive.Widgets.WindowManager=function(){var e=700,t=1200,n=500,r=!1,i=null;this.changeTitle=function(e){window.document.title=e};var s=function(t,n){if(!n||!r)return;n--;var i=window.document.title;setTimeout(function(){window.document.title=t,s(i,n)},e)};this.stopTitleAnimation=function(){r=!1,i&&setTimeout(function(){window.document.title=xplive.AppName},t)};var o=!1;this.popUpNotification=function(e,t){try{if(o)return;var n=window.webkitNotifications.createNotification("",e,t);n.onclick=function(){window.focus(),this.cancel(),o=!1},n.onclose=function(){this.cancel(),o=!1},n.show(),o=!0}catch(r){sOn.Logger.logException(r)}},this.animateTitle=function(e){r=!0,i=window.document.title,s(e,n)}},xplive.Widgets.TodayTotals=function(e,t){sOn.Widgets.Panel.call(this,e,t),this.show=function(e){var t="<b>Work time: </b>"+(new xplive.Common.Duration(e.timeDelta)).toString(),n=" <b>Interruptions:</b> "+e.interruptions,r=" <b>Planified tasks:</b> "+e.planifiedTasks;r+=" <b>Unexpected tasks:</b> "+e.unexpectedTasks;var i=" <b>Pomodoros:</b> "+e.pomodoros,s="<br/>",o="<b>Today's stats:</b><hr/>"+t+s+n+s+r+s+i;o+="<hr/><small><em>Stats calculated at: "+e.lastCalculationTime,o+="</em></small>",this.getNativeWidget().html(o)}},xplive.Widgets.TodayTotals.prototype=new sOn.Widgets.Panel,xplive.Widgets.ProgressBar=function(e,t){e=e||sOn.Widgets.getRandomId(),sOn.Widgets.Panel.call(this,e,t),this._createDomElement=function(){this.labelId="label_"+sOn.Widgets.getRandomId(),this.barId="bar_"+sOn.Widgets.getRandomId();var t='<div id="'+e+'">';t+='  <div id="'+this.labelId+'">To start the countdown click the play button</div>',t+='  <div class="progress progress-striped active">',t+='    <div id ="'+this.barId+'" class="bar" style="width: 0%;">0%</div>',t+="  </div>",t+="</div>";var n=$(t);this.registerNativeWidget(n),this.placeholder.append(n)};var n=null,r=null;this.label=function(){return n||(n=$("#"+this.labelId)),n},this.bar=function(){return r||(r=$("#"+this.barId)),r},this.inactiveBar=function(){$("#"+this.elementId).find(".progress").removeClass("active"),this.label().removeClass("lead")},this.remarkMinuteChange=function(){this.label().addClass("minuteChange")},this.start=function(){this.label().addClass("lead"),$("#"+this.elementId).find(".progress").addClass("active")},this.update=function(e){this.label().removeClass("minuteChange");var t=e.username||"";this.label().text(t+" "+e.remainingMinutes);var n=e.percent.toString()+"%";this.bar().css("width",n),this.bar().text("completed "+n)}},xplive.Widgets.ProgressBar.prototype=new sOn.Widgets.Panel,xplive.Widgets.ChatConversationViewer=function(e){e=e||$("<div>"),this.showMessage=function(t){var n='<div class="'+xplive.Widgets.TeamMate.wholeMessage+'">';n+='<span class="'+xplive.Widgets.TeamMate.msgInfo+'">',n+=t.visibleReceiptTime+" "+t.sender+"</span> =&gt; ",n+='<span class="'+xplive.Widgets.TeamMate.msgBody+'">',n+=t.body,n+="</span>",n+="</div>",e.append(n),e.scrollTop(20+e.height()+e[0].scrollHeight+e.offset().top)}},xplive.Widgets.TeamMate=function(e,t,n){sOn.Widgets.Widget.call(this,e,t),this.mateName=n},xplive.Widgets.TeamMate.modalCss="modal hide fade in",xplive.Widgets.TeamMate.headerCss="modal-header",xplive.Widgets.TeamMate.bodyCss="modal-body",xplive.Widgets.TeamMate.pendingCss="modal-pending",xplive.Widgets.TeamMate.footerCss="modal-footer",xplive.Widgets.TeamMate.inputCss="chat_textarea",xplive.Widgets.TeamMate.msgInfo="chat_msginfo",xplive.Widgets.TeamMate.chatLabelCss="chat_label",xplive.Widgets.TeamMate.msgBody="chat_msgbody",xplive.Widgets.TeamMate.wholeMessage="chat_wholemsg",xplive.Widgets.TeamMate.pomodoroWarning="chat_pomodoro_warning",xplive.Widgets.TeamMate.prototype=new sOn.Widgets.Widget,xplive.Widgets.TeamMate.prototype.onHeaderClick=function(){},xplive.Widgets.TeamMate.prototype.bringToFront=function(e){this.getNativeWidget().css("z-index",e)},xplive.Widgets.TeamMate.prototype._createDomElement=function(){var e=$("<div>",{id:this.elementId});e.addClass(xplive.Widgets.TeamMate.modalCss),this.header=$("<div>");var t=this.header,n=this;this.header.addClass(xplive.Widgets.TeamMate.headerCss),this.header.appendTo(e),this.closeBtn=new sOn.Widgets.Button("closeBtn"+this.mateName,this.header,"X",sOn.Widgets.Button.types.close),this.headerText=$("<h3>"),this.subHeaderText=$("<p>"),this.chatLabel=$("<div>"),this.chatLabel.text("Conversation:"),this.chatLabel.addClass(xplive.Widgets.TeamMate.chatLabelCss),this.chatLabel.appendTo(e),this.body=$("<div>"),this.body.addClass(xplive.Widgets.TeamMate.bodyCss),this.body.appendTo(e),this.chatViewer=new xplive.Widgets.ChatConversationViewer(this.body),this.pendingMessagesLabel=$("<div>"),this.pendingMessagesLabel.text("Not delivered yet:"),this.pendingMessagesLabel.addClass(xplive.Widgets.TeamMate.chatLabelCss),this.pendingMessagesLabel.appendTo(e),this.pendingMessages=$("<div>"),this.pendingMessages.addClass(xplive.Widgets.TeamMate.pendingCss),this.pendingMessages.appendTo(e),this.pendingMessagesViewer=new xplive.Widgets.ChatConversationViewer(this.pendingMessages),this.pomodoroWarningMessage="Remember: chat messages will be displayed to her/him as the pomodoro finishes.",this.pomodoroWarning=$("<div>"),this.pomodoroWarning.html(this.pomodoroWarningMessage),this.pomodoroWarning.addClass(xplive.Widgets.TeamMate.pomodoroWarning),this.pomodoroWarning.appendTo(e),this.pomodoroWarning.hide(),this.inputTextPlaceholder=$("<div>"),this.inputTextPlaceholder.appendTo(e),this.inputTextArea=new sOn.Widgets.TextArea("textInput"+this.mateName,this.inputTextPlaceholder);var r=$("<div>");r.addClass(xplive.Widgets.TeamMate.footerCss),r.appendTo(e),r.click(function(){n.onHeaderClick(n)}),this.header.click(function(){n.onHeaderClick(n)}),e.appendTo(this.placeholder),this.registerNativeWidget(e)},xplive.Widgets.TeamMate.prototype.onNewMessageIntroduced=function(){},xplive.Widgets.TeamMate.prototype._initializeDomElement=function(){this.closeBtn.initialize();var e="."+xplive.Widgets.TeamMate.bodyCss+",."+xplive.Widgets.TeamMate.pendingCss+", textarea";this.getNativeWidget().draggable({cancel:e}),this.headerText.appendTo(this.header),this.subHeaderText.appendTo(this.header);var t=this;this.closeBtn.onClick=function(){t.hide()},this.body.click(function(){t.onHeaderClick(t)}),this.pendingMessages.click(function(){t.onHeaderClick(t)}),this.inputTextArea.initialize(),this.inputTextArea.addClass(xplive.Widgets.TeamMate.inputCss),this.inputTextArea.onEnter=function(){var e=this.text();e!="\n"&&e!="\r"&&t.onNewMessageIntroduced(e),this.setText("")},this.inputTextArea.getNativeWidget().click(function(){t.onHeaderClick(t)})},xplive.Widgets.TeamMate.prototype.updateMateActivity=function(e){e&&(this.headerText.text(e.info.displayableUsername),this.subHeaderText.html(e.info.displayableInfo),this.pomodoroWarning.hide(),e.isOnPomodoro&&this.pomodoroWarning.show())},xplive.Widgets.TeamMate.prototype._randomTopPosition=function(){var e=this.getNativeWidget().height()-200;return Math.ceil(Math.random()*200)+e},xplive.Widgets.TeamMate.prototype._randomLeftPosition=function(){var e=this.getNativeWidget().width()/2;return Math.ceil(Math.random()*e)+e},xplive.Widgets.TeamMate.prototype.changePositionRandomly=function(){try{this.getNativeWidget().css("top",this._randomTopPosition()),this.getNativeWidget().css("left",this._randomLeftPosition())}catch(e){sOn.Logger.logException(e)}},xplive.Widgets.TeamMate.prototype._showMessage=function(e,t){t.showMessage(e),this.show()},xplive.Widgets.TeamMate.prototype.focusOnInput=function(){this.inputTextArea.focus()},xplive.Widgets.TeamMate.prototype.showPendingMessage=function(e){this._showMessage(e,this.pendingMessagesViewer)},xplive.Widgets.TeamMate.prototype.clearPendingMessages=function(){this.pendingMessages.html("")},xplive.Widgets.TeamMate.prototype.showNewMessage=function(e){this._showMessage(e,this.chatViewer)},xplive.Widgets.TeamMate.prototype.showMate=function(){this.show()},xplive.Widgets.MatesWidget=function(e){this.placeholder=e||$("body"),this.membersDetailsWidgets={length:0};var t={},n=this;this.frontWidgetZindex=10;var r=function(e){t[e]={};var r=n.membersDetailsWidgets[e];if(!r){var i=+e+sOn.Widgets.getRandomId();r=new xplive.Widgets.TeamMate("msg"+i,n.placeholder,e),r.initialize(),r.onHeaderClick=function(){n.frontWidgetZindex++,this.bringToFront(n.frontWidgetZindex)},r.onNewMessageIntroduced=function(t){n.onNewMessageIntroduced(e,t)},r.changePositionRandomly(),n.membersDetailsWidgets.length=n.membersDetailsWidgets.length+1,n.membersDetailsWidgets[e]=r}};this.showNewMessage=function(e,t){r(e),n.membersDetailsWidgets[e].showNewMessage(t)},this.showPendingMessage=function(e,i){r(e),t[e][i.id]=i,n.membersDetailsWidgets[e].showPendingMessage(i)},this.clearPendingMessages=function(e){r(e),n.membersDetailsWidgets[e].clearPendingMessages()},this.moveMessageFromPendingToSent=function(e,r){var i=n.membersDetailsWidgets[e];i.clearPendingMessages(),i.showNewMessage(r),delete t[e][r.id];for(var s in t[e])i.showPendingMessage(t[e][s])},this.showMateInfo=function(e){r(e),this.frontWidgetZindex++,n.membersDetailsWidgets[e].showMate(),n.membersDetailsWidgets[e].bringToFront(this.frontWidgetZindex),n.membersDetailsWidgets[e].focusOnInput()},this.updateMateActivity=function(e,t){r(e),n.membersDetailsWidgets[e].updateMateActivity(t)},this.onNewMessageIntroduced=function(){}},xplive.Widgets.TeamViewer=function(e,t){sOn.Widgets.Panel.call(this,e,t);var n=this;this.membersButtons={};var r=function(e){var t="";return e.itsMe&&(t=xplive.Styles.memberIsMyself+" "),e.severalSessionsOpenWithSameAccount?t+xplive.Styles.severalSessionsOpenWithSameAccount:e.isApparentlyOffline?t+xplive.Styles.memberOffline+" "+xplive.Styles.disabled:e.isOnPomodoro?t+xplive.Styles.memberOnPomodoro:e.isTakingBreak?t+xplive.Styles.memberIsTakingBreak:t+xplive.Styles.memberAvailable},i=function(e,t){e.getCssClasses()!=t&&(e.removeClass(),e.addClass(t))},s=function(e,t,n){var s=r(t);i(e,s),e.getNativeWidget().attr("title",t.info.displayableInfo);var o='<span class="bigMateMonitorInfo">';o+=t.info.shortDisplayableInfo+"</span></br>",o+='<span class="smallMateMonitorInfo">',o+=t.info.summaryDisplayableInfo+"</span>",e.getNativeWidget().html(o)};this.onShowMateInfo=function(e){};var o=null,u=function(e){var t=n.membersButtons[e];t||(t=new sOn.Widgets.Button(e+sOn.Widgets.getRandomId(),n.getNativeWidget(),"",null),t.initialize(),t.onClick=function(){n.onShowMateInfo(e)},n.membersButtons[e]=t)},a=function(e){for(var t in e)u(t),s(n.membersButtons[t],e[t],t)};this.updateTeamActivity=function(e){if(_.isEmpty(e)){this.setText("There is no team activity registered. Nobody else in your team is online right now");return}o||this.setText(""),o=e,a(e)}},xplive.Widgets.TeamViewer.prototype=new sOn.Widgets.Panel,xplive.Widgets.ExclusiveButtonToolbar=function(){sOn.Widgets.Widget.call(this);var e={};this.addButtons=function(t){for(var n in t){var r=t[n];button=new sOn.Widgets.Button(r),button.initialize(),e[n]=button}},this.getButton=function(t){return e[t]},this.activate=function(t){for(var n in e)e[n].removeClass(xplive.Widgets.ExclusiveButtonToolbar.activeCss);e[t].addClass(xplive.Widgets.ExclusiveButtonToolbar.activeCss)}},xplive.Widgets.ExclusiveButtonToolbar.activeCss="active",xplive.Widgets.ExclusivePanelList=function(){sOn.Widgets.Widget.call(this);var e={};this.addPanels=function(t){for(var n in t){var r=t[n];panel=new sOn.Widgets.Panel(r),panel.initialize(),e[n]=panel}},this.getPanel=function(t){return e[t]},this.show=function(t){for(var n in e)e[n].hide();e[t].show()},this.hide=function(t){e[t].hide()},this.showAllBut=function(t){for(var n in e)e[n].show();e[t].hide()}},xplive.Widgets.SoundPlayer=function(e,t){sOn.Widgets.Widget.call(this,sOn.Widgets.getRandomId(),t),this.fullFilePath=e,this.play=function(){if(xplive.Widgets.SoundPlayer.isTestMode)return;try{var t=this.getNativeWidget()[0];t.volume=.5,t.readyState==0&&"webkitAudioContext"in window?t.src=e+".mp3":t.currentTime=0,t.currentTime>0&&(t.canPlayType("audio/mpeg")?t.src=e+".mp3":t.src=e+".ogg"),t.play()}catch(n){}}},xplive.Widgets.SoundPlayer.isTestMode=!1,xplive.Widgets.SoundPlayer.prototype=new sOn.Widgets.Widget,xplive.Widgets.SoundPlayer.prototype._createDomElement=function(){if(xplive.Widgets.SoundPlayer.isTestMode)return;var e="<audio>";e+='<source src="'+this.fullFilePath+'.ogg" type="audio/ogg">',e+="</audio>";var t=$(e);t.appendTo(this.placeholder),this.registerNativeWidget(t)},xplive.Widgets.PomodoroPopup=function(){this.alert=function(){var e=window.open("","Pomodoro is finished","width=300,height=130, menubar=0,toolbar=0,status=0,scrollbars=1,resizable=1"),t="<html><head><title>Pomodoro has finished</title></head>";t+='<body style="background-color: #eee; color: #013B58;"><h3>Pomodoro has finished</h3><h4>It is time to take a short break, it is really important to rest for a few minutes.</h4></body></html>',e.document.writeln(t),e.document.close()}},xplive.Storage.Server=function(){sOn.Network.Client.call(this),this.urlForErrorLog="/log_js_error",this.saveTasks=function(e,t){var n=this;this.requestData(t.host+"/save_user_data",{username:t.username,team:t.team,userData:JSON.stringify(e)},function(t){})},this.loadTasks=function(e,t){var n=this;this.requestData(e.host+"/load_user_data",{username:e.username,team:e.team},function(n){t.handleLoadedTasks(n)})},this.updateUserActivity=function(e,t){var n=this;this.requestData(e.host+"/update_user_activity",{username:e.username,team:e.team,activity:JSON.stringify(t)},function(t){})},this.retrieveTeamActivity=function(e,t){var n=this;this.requestData(e.host+"/retrieve_team_activity",{team:e.team},function(n){t(n)})}},xplive.Storage.Server.prototype=new sOn.Network.Client,xplive.Tasks.TheBeginning=new Date(1981,5,15),xplive.Tasks.PlanifiedTask=function(e){this.status=xplive.Status.RUNNING,this.shortDescription="  ",this.longDescription="  ",this.ticketId="   ",this.enabledAction=xplive.Actions.STOP,this.interruptionsCount=0,this.interruptionsCountToday=0,this.pomodoros=0,this.kind=xplive.Kinds.PLANIFIED,this.startTime=new Date,this.elapsedTime=new xplive.Common.Duration,this.elapsedTimeToday=new xplive.Common.Duration,sOn.Models.sOnDTO.call(this,e);var t=this,n=function(e){var n=e-t.startTime;s(n)},r=function(){t.interruptionsCount++,t.interruptionsCountToday++};this.finish=function(e){this.status==xplive.Status.RUNNING&&n(e),this.status=xplive.Status.FINISHED},this.stop=function(e){this.status==xplive.Status.RUNNING&&(n(e),r()),this.status=xplive.Status.STOPPED,this.enabledAction=xplive.Actions.RESUME},this.isEquivalent=function(e){return e?this.id==e.id&&this.shortDescription==e.shortDescription&&this.longDescription==e.longDescription&&this.ticketId==e.ticketId:!1},this.toCSV=function(){var e="";return e+=this.id.toString()+",",e+=this.status+",",e+=this.kind.toString()+",",e+=this.interruptionsCount+",",e+=this.interruptionsCountToday+",",e+=this.title+",",e+=this.ticketId+",",e+=this.shortDescription+",",e+=this.longDescription+",",e+=this.startTime.toISOString()+",",e+=this.elapsedTime.delta+",",e+=this.pomodoros+",",e+=this.elapsedTime.toString(),e};var i=function(e){t.hasBeenStartedToday()||(t.elapsedTimeToday.delta=0,t.interruptionsCountToday=0),t.startTime=e};this.resume=function(e){this.status=xplive.Status.RUNNING,this.enabledAction=xplive.Actions.STOP,i(e)};var s=function(e){t.elapsedTimeToday.increase(e),t.elapsedTime.increase(e)};this.hasBeenStartedToday=function(){var e=new Date;return this.startTime.getDate()==e.getDate()&&this.startTime.getMonth()==e.getMonth()&&this.startTime.getFullYear()==e.getFullYear()},this.toJSON=function(){var e=this.clone();return e.startTime=e.startTime.valueOf()-xplive.Tasks.TheBeginning.valueOf(),e}},xplive.Tasks.PlanifiedTask.prototype=new sOn.Models.sOnDTO,xplive.Tasks.PlanifiedTask.constructor=xplive.Tasks.PlanifiedTask,xplive.Tasks.UnexpectedTask=function(e){xplive.Tasks.PlanifiedTask.call(this,e),this.kind=xplive.Kinds.UNEXPECTED},xplive.Tasks.UnexpectedTask.prototype=new xplive.Tasks.PlanifiedTask,xplive.Tasks.UnexpectedTask.constructor=xplive.Tasks.UnexpectedTask,xplive.Tasks.FromRawObject=function(e){var t=new xplive.Tasks.PlanifiedTask(e);return e.kind!=xplive.Kinds.PLANIFIED&&(t=new xplive.Tasks.UnexpectedTask(e)),isSerializedDate(e.startTime)&&(t.startTime=new Date(parseInt(e.startTime)+xplive.Tasks.TheBeginning.valueOf())),e.elapsedTime&&(t.elapsedTime=new xplive.Common.Duration(e.elapsedTime.delta)),e.elapsedTimeToday&&(t.elapsedTimeToday=new xplive.Common.Duration(e.elapsedTimeToday.delta)),t},xplive.Interactors.TasksCounter=function(){var e=function(e){var t=0;for(var n=0,r=e.length;n<r;n++)e[n].id>t&&(t=e[n].id);return t};this.findTheHighestTaskId=function(t,n){var r=e(t),i=e(n);return r>i?r:i}},xplive.Interactors.Exporter=function(){var e=function(e){var t="";for(var n=0;n<e.length;n++)t+=e[n].toCSV()+"\r\n";return t};this.toCSV=function(t){var n=e(t.ongoingTasks);return n+=e(t.finishedTasks),n}},xplive.Interactors.Tasks=function(e){var t=0,n=this;sOn.Interactors.Interactor.call(this,["taskButton","tasksBinder","unexpectedTaskButton","finishedBinder","exportLauncher","exportWidget"]),this.timeDeltaCalculator=new xplive.Common.TimeDeltaCalculator,this.clock=new xplive.Clock,this.tasksCounter=new xplive.Interactors.TasksCounter,this.exporter=new xplive.Interactors.Exporter,this.onTaskStatusChanged=function(e){},this.allTasks=function(){return{currentTask:this.currentTask(),ongoingTasks:this._tasksBinder.getBusinessCollection().models,finishedTasks:this._finishedBinder.getBusinessCollection().models}};var r=function(e,t){if(e){for(var n=0,r=e.length;n<r;n++){var i=xplive.Tasks.FromRawObject(e[n]);t.add(i)}t.refresh()}};this.populateFromStorage=function(e){r(e.ongoingTasks,this._tasksBinder),r(e.finishedTasks,this._finishedBinder),t=this.tasksCounter.findTheHighestTaskId(n._tasksBinder.getBusinessCollection().models,n._finishedBinder.getBusinessCollection().models)},this.whatTheUserCanSeeInTheScreen=function(){return $("body").html()},this.guiText=function(){return $("body").html()},this.startNewUnexpectedTask=function(){return i(new xplive.Tasks.UnexpectedTask)},this.startNewPlanifiedTask=function(e){return i(new xplive.Tasks.PlanifiedTask(e))};var i=function(e){return s(),e.id=t+1,t++,n._tasksBinder.add(e),n._tasksBinder.refresh(),n.onTaskStatusChanged(n.allTasks()),e},s=function(){var e=n.clock.giveMeTheTime();o(function(t){t.stop(e)},n._tasksBinder),n._tasksBinder.refresh()};this.currentTask=function(){var e=this._tasksBinder.getBusinessCollection().models;for(var t=0,n=e.length;t<n;t++)if(e[t].status==xplive.Status.RUNNING)return e[t];return null},this.stopCurrentTask=function(){s(),this.onTaskStatusChanged(this.allTasks())},this.resumeStoppedTask=function(e){s(),e.resume(this.clock.giveMeTheTime()),this._tasksBinder.refresh(),this.onTaskStatusChanged(this.allTasks())},this.finishTask=function(e){e.finish(this.clock.giveMeTheTime()),this._finishedBinder.add(e),n.onTaskStatusChanged(n.allTasks())};var o=function(e,t){var n=t.getBusinessCollection().models;n.map(e)};this._subscribeEvents=function(){this._exportLauncher.onClick=function(){var e=n.exporter.toCSV(n.allTasks());n._exportWidget.show(e)},this._taskButton.onClick=function(){n.startNewPlanifiedTask()},this._unexpectedTaskButton.onClick=function(){n.startNewUnexpectedTask()},this._tasksBinder.onColumnClicked=function(e,t){e.status==xplive.Status.STOPPED?n.resumeStoppedTask(e):n.stopCurrentTask()},this._tasksBinder.onItemRemoval=function(e){n.finishTask(e)},this._tasksBinder.onItemChanged=function(e){n.onTaskStatusChanged(n.allTasks())},this._finishedBinder.onItemRemoval=function(e){n.onTaskStatusChanged(n.allTasks())},this._finishedBinder.onItemChanged=function(e){n.onTaskStatusChanged(n.allTasks())}}},xplive.Interactors.TotalsCalculator=function(){sOn.Interactors.Interactor.call(this,["todayTotalsWidget","tasksService","pomodoroInteractor"]);var e=this;pomodorosCount=0,allTasksReceived={ongoingTasks:[],finishedTasks:[]};var t=function(){this.planifiedTasks=0,this.unexpectedTasks=0,this.interruptions=0,this.time="",this.timeDelta=0,this.pomodoros=0,this.prepareTimes=function(){this.time=new xplive.Common.Duration(this.timeDelta),this.lastCalculationTime=(new Date).toTimeString().substring(0,8)},this.setPomodorosCount=function(e){this.pomodoros=e},this.addTaskToTotal=function(e){if(!e.hasBeenStartedToday())return;e.kind==xplive.Kinds.PLANIFIED?this.planifiedTasks++:this.unexpectedTasks++,this.interruptions+=e.interruptionsCountToday,e.elapsedTimeToday?this.timeDelta+=e.elapsedTimeToday.delta:this.timeDelta+=e.elapsedTime.delta}},n=function(e,t){if(t)for(var n=0,r=t.length;n<r;n++)e.addTaskToTotal(t[n])};this.recalculateTasksTotals=function(e){var r=new t;n(r,e.ongoingTasks),n(r,e.finishedTasks),r.prepareTimes(),r.setPomodorosCount(pomodorosCount),this._todayTotalsWidget.show(r),this.totals=[r]},this.whatTheUserCanSeeInTheScreen=function(){return"1"},this.tasksTotals=function(){return this.totals};var r=function(t,n){pomodorosCount++,e.recalculateTasksTotals(allTasksReceived),allTasksReceived.currentTask&&allTasksReceived.currentTask.pomodoros++};this._subscribeEvents=function(){this._tasksService.onTaskStatusChanged=function(t){allTasksReceived=t,e.recalculateTasksTotals(allTasksReceived)},sOn.Factory.EventBus().addSubscriber(r,xplive.Events.pomodoroFinished)}},xplive.Interactors.Pomodoros=function(){function r(e){return e.percent>=100?"Finished":e.remainingMinutes==0?"less than a minute left":"about "+e.remainingMinutes+" minutes left"}sOn.Interactors.Interactor.call(this,["progressBar","pomodoroLauncher","pomodoro","pomodoroTerminator","sizeInMinutesBox","alertDialog","windowManager","soundPlayer"]);var e=this,t=-1,n=-1,i=function(r,i){t!=r.percent&&(e._progressBar.update(r),e._windowManager.changeTitle(r.remainingMinutes),i!=n&&(e._progressBar.remarkMinuteChange(),e._sizeInMinutesBox.setText(i),a(xplive.Events.pomodoroChanged,{isOn:!0,remainingMinutes:r.remainingMinutes})))},s=function(e){var s=(new sOn.Models.sOnDTO(e)).clone(),o=s.remainingMinutes;s.remainingMinutes=r(s),i(s,o),n=o,t=s.percent},o=function(){e._soundPlayer.play(),s({sizeInMinutes:e._pomodoro.sizeInMinutes,remainingMinutes:0,percent:100}),e._progressBar.inactiveBar(),e._windowManager.changeTitle("LiveTeamApp"),e._pomodoroLauncher.show(),e._pomodoroTerminator.hide(),e._sizeInMinutesBox.enable(),e._sizeInMinutesBox.setText(e._pomodoro.sizeInMinutes)},u=function(){e._progressBar.start(),s({sizeInMinutes:e._pomodoro.sizeInMinutes,remainingMinutes:e._pomodoro.sizeInMinutes,percent:0}),e._pomodoroLauncher.hide(),e._pomodoroTerminator.show(),e._sizeInMinutesBox.disable()};this.fireEvent=function(e,t){a(e,t)};var a=function(e,t){sOn.Factory.EventBus().emit(e,t)};this.startPomodoro=function(t){e._pomodoro.sizeInMinutes=t,e._pomodoro.start(),u(),a(xplive.Events.newPomodoroStarted,{isOn:!0,remainingMinutes:t})},this.stopPomodoro=function(){e._pomodoro.finish(),f()};var f=function(){o(),a(xplive.Events.pomodoroFinished,{isOn:!1,remainingMinutes:0})};this._subscribeEvents=function(){e._pomodoroLauncher.onClick=function(){var t=parseInt(e._sizeInMinutesBox.text());isNaN(t)&&(t=30),e.startPomodoro(t)},e._pomodoroTerminator.onClick=function(){e.stopPomodoro()},e._pomodoro.onStatusChanged=function(e){s(e)},e._pomodoro.onTimeOver=function(){f(),xplive.Common.ExecAsync(function(){e._alertDialog.alert()},1e3)}},this._postInitialize=function(){this._sizeInMinutesBox.text()||this._sizeInMinutesBox.setText(this._pomodoro.sizeInMinutes.toString())},this.onPomodoroChanged=function(){},this.onPomodoroFinished=function(){},this.onPomodoroStarted=function(){}},function(e){var t="Status",n="Type",r="Id",i=[{mDataProp:"id",bSortable:!1,sTitle:r,bVisible:!1},{mDataProp:"status",bSortable:!1,sTitle:t},{mDataProp:"kind",bSortable:!1,sTitle:n},{mDataProp:"shortDescription",bSortable:!1,sTitle:"Details (estimation, ...)",bEditable:!0,charsSize:50},{mDataProp:"ticketId",bSortable:!1,sTitle:"Ticket Id",bEditable:!0,charSize:5}];e.Finished=sOn.DataBinders.TableDataBinder.override({_defineColumns:function(){var e=i.slice();e.push({mDataProp:"startTime",bSortable:!1,sTitle:"Start Time"}),e.push({mDataProp:"elapsedTime",sTitle:"Elapsed time"}),e.push({mDataProp:"pomodoros",sTitle:"Pomodoros"}),e.push({mDataProp:"interruptionsCount",sTitle:"Interruptions"}),this.widget.removeColumnTitle="Delete",this.widget.setColumns(e,!1,!0)}}),e.Tasks=sOn.DataBinders.TableDataBinder.override({_defineColumns:function(){var t=i.slice(),n="Action";t.splice(0,0,{mDataProp:"enabledAction",bSortable:!1,bClickable:!0,sTitle:n}),this.widget.removeColumnTitle="Finish",this.widget.setColumns(t,!1,!0);var r=new e.TaskRenderDetails(n,this);this.widget.defineRowRenderDetails(r)}}),e.TaskRenderDetails=function(i,s){var o=this;this.calculateBy=function(o){var u=s.getBusinessCollection().get(o),a="statusCss",f={columnTitle:t,cssClass:a},l=e.TaskRenderDetails.taskOnCss;return u.status.indexOf(xplive.Status.RUNNING)>-1&&(f.cssClass=e.TaskRenderDetails.runningStatus,u.kind==xplive.Kinds.UNEXPECTED&&(f.cssClass=e.TaskRenderDetails.unexpectedRunningStatus)),u.status.indexOf(xplive.Status.STOPPED)>-1&&(f.cssClass=e.TaskRenderDetails.stoppedStatus,l=e.TaskRenderDetails.taskOffCss),[{columnTitle:i,cssClass:l},{columnTitle:r,cssClass:f.cssClass},{columnTitle:n,cssClass:f.cssClass},f]}},e.TaskRenderDetails.runningStatus=xplive.Styles.runningStatus,e.TaskRenderDetails.unexpectedRunningStatus=xplive.Styles.unexpectedRunningStatus,e.TaskRenderDetails.stoppedStatus=xplive.Styles.stoppedStatus,e.TaskRenderDetails.stopActionCss=xplive.Styles.stopActionCss,e.TaskRenderDetails.taskOnCss=xplive.Styles.taskOnCss,e.TaskRenderDetails.taskOffCss=xplive.Styles.taskOffCss}(xplive.DataBinders),xplive.Clock=function(){var e=this;this.giveMeTheTime=function(){return new Date},this.start=function(t){setInterval(function(){e.onTick(new Date)},t)},this.currentTime=function(){return new Date},this.stop=function(){clearInterval()},this.onTick=function(e){}},xplive.Pomodoro=function(){function r(t,n){var r=n-t;return e.sizeInMinutes-Math.floor(r/1e3/60*10)/10}function i(t){return Math.ceil((100-t*100/e.sizeInMinutes)*10)/10}function s(e){return Math.floor(e)+1}var e=this,t=new Date;this.sizeInMinutes=30,this.refreshEveryMilliseconds=1e3,this.start=function(){t=new Date,this.clock.start(this.refreshEveryMilliseconds),o()},this.finish=function(){this.clock.stop(),n()};var n=function(){e.clock.onTick=function(){}},o=function(){e.clock.onTick=function(n){var o=r(t,n);o>0?e.onStatusChanged({status:xplive.Status.RUNNING,sizeInMinutes:e.sizeInMinutes,remainingMinutes:s(o),percent:i(o)}):(e.finish(),e.onTimeOver())}};this.onStatusChanged=function(e){},this.onTimeOver=function(){}},xplive.Chat.ChatProxy=function(e){var t,n=this;this.connect=function(){t=io.connect(xplive.Common.ChatServerAddress),t.on("receivedMessage"+e.team+e.username,function(e){n.onReceivedMessage(e)}),t.on("receivedTeamMessage"+e.team,function(e){n.onWholeTeamMessage(e)}),t.on("confirmationReceived"+e.team+e.username,function(t){t.receiver=t.receiver.replace(e.team,""),n.onConfirmationReceived(t)})},this.confirmReception=function(n){n.confirmTo=e.team+n.sender,t.emit("confirmReception",n)},this.sendMessage=function(n){n.receiver=e.team+n.receiver,t.emit("sendMessage",n)},this.sendMessageToTeam=function(e){t.emit("sendTeamMessage",e)},this.onConfirmationReceived=function(e){},this.onReceivedMessage=function(e){},this.onWholeTeamMessage=function(e){}},xplive.Services.Tasks=function(e){sOn.Interactors.Interactor.call(this,["interactor","storage","totalsCalculator"]);var t=this;this.handleLoadedTasks=function(e){this._interactor.populateFromStorage(e),n(this._interactor.allTasks())};var n=function(e){t._currentTask=e.currentTask,t.onTaskStatusChanged(e)};this.loadExistingData=function(){this._storage.loadTasks(e,this)},this.currentTask=function(){return t._currentTask},this._subscribeEvents=function(){this._interactor.onTaskStatusChanged=function(r){t._storage.saveTasks(r,e),n(r)}},this.onTaskStatusChanged=function(e){}},xplive.Services.ActivityFormatter=function(){},xplive.Services.ActivityFormatter.generateCurrentTaskInfo=function(e,t){var n="",r="";t.summaryDisplayableInfo="",e.currentTask.shortDescription&&(r=e.currentTask.shortDescription.trim(),r.length>0&&(n+=r),r.length>20?t.summaryDisplayableInfo=r.substring(0,30)+"...":r.length>1&&(t.summaryDisplayableInfo=r));var i="";e.currentTask.ticketId&&(i=e.currentTask.ticketId.trim()),i.length>0&&(n.length>0&&(n+=", "),n+="Ticket: "+i,t.summaryDisplayableInfo.length>0&&(t.summaryDisplayableInfo+=", "),t.summaryDisplayableInfo+="#"+i),t.displayableInfo+=n,t.summaryDisplayableInfo==""&&(t.summaryDisplayableInfo="Working on some task"),t.summaryDisplayableInfo=t.summaryDisplayableInfo.replace(/##/g,"#"),t.summaryDisplayableInfo="("+t.summaryDisplayableInfo+")"},xplive.Services.ActivityFormatter.generateDisplayableInfo=function(e){var t={summaryDisplayableInfo:"",displayableInfo:""},n=e.username||"   ";return t.shortDisplayableInfo=n.charAt(0).toUpperCase()+n.slice(1),t.displayableUsername=t.shortDisplayableInfo,e.itsMe&&(t.displayableInfo+="",t.shortDisplayableInfo="> "+t.shortDisplayableInfo+" <"),e.isOnPomodoro&&(t.displayableInfo+=" On pomodoro: "+e.pomodoro.remainingMinutes+". ",t.shortDisplayableInfo+="  ("+e.pomodoro.remainingMinutes+")"),e.isTakingBreak?(t.displayableInfo+="Apparently taking a break",t.summaryDisplayableInfo="("+t.displayableInfo+")",t):e.isApparentlyOffline?(t.shortDisplayableInfo=t.displayableUsername+" (offline)",t.displayableInfo="Is offline",t):(e.currentTask&&xplive.Services.ActivityFormatter.generateCurrentTaskInfo(e,t),t)},xplive.Services.MemberActivity=function(e){this.id=0,this.currentTask=null,this.pomodoro=null,this.previousPomodoroChanged=!1,sOn.Models.sOnDTO.call(this,e);var t=this,n=function(){t.info=xplive.Services.ActivityFormatter.generateDisplayableInfo(t)},t=this,r=function(e,n,r){t.itsMe=!1,t.severalSessionsOpenWithSameAccount=!1,e==n&&(t.itsMe=!0,t.severalSessionsOpenWithSameAccount=!r.contains(t))},i=function(e,n){t.isOnPomodoro=!1,t.pomodoro&&t.pomodoro.isOn&&(t.isOnPomodoro=!0)},s=function(e,n){!t.isOnPomodoro&&!t.currentTask&&(t.isTakingBreak=!0)},o=function(e,n){t.username=e};this.interpret=function(e,t,u){o(e,t);if(this.isApparentlyOffline){this.setAsApparentlyOffline();return}r(e,t,u),i(e,t),s(e,t),n()},this.generateId=function(e){this.id=e-xplive.Tasks.TheBeginning},this.isOlderThanMaximunTeamActivity=function(e){var t=e-xplive.Tasks.TheBeginning,n=t-this.id;return n>xplive.Common.MaximunTeamInactivity},this.currentTaskHasChanged=function(e){return!this.currentTask&&e||this.currentTask&&!this.currentTask.isEquivalent(e)},this.isThereAnyNewActivity=function(e){return this.currentTaskHasChanged(e)||this.previousPomodoroChanged},this.updatePomodoroActivity=function(e){JSON.stringify(this.pomodoro)!=JSON.stringify(e)&&(this.previousPomodoroChanged=!0,this.pomodoro=e)},this.refresh=function(e,t){this.currentTask=t,this.generateId(e)},this.resetPomodoroChange=function(){this.previousPomodoroChanged=!1},this.setAsApparentlyOffline=function(){this.id++,this.isApparentlyOffline=!0,n()}},xplive.Services.MemberActivity.prototype=new sOn.Models.sOnDTO,xplive.Services.RecentActivity=function(e){this.length=e.length;for(var t=0,n=this.length;t<n;t++)this[t]=e[t];this.contains=function(t){return!0}},xplive.Services.ActivityHistorian=function(){var e=[],t=xplive.Common.MaximunMissingMateUpdatesToConsiderOffline+1;this.recordNewActivity=function(n){return},this.getRecentActivity=function(){return new xplive.Services.RecentActivity([])}},xplive.Services.ActivityHistorian.RECENT_ACTIVITY_SIZE=xplive.Common.MaximunMissingMateUpdatesToConsiderOffline*2,xplive.Services.InactivityDetector=function(){this.discardInactiveUsers=function(e,t){var n=[];for(var r in e)e[r].isOlderThanMaximunTeamActivity(t)&&n.push(r);for(var i=0,s=n.length;i<s;i++)delete e[n[i]]}},xplive.Services.TeamInterpreter=function(){sOn.Interactors.Interactor.call(this,["inactivityDetector"]);var e={},t=function(t,n){var r=e[n];r?r.lastReceivedId==t.id?r.timesThatSameActivityIsReceived++:r.timesThatSameActivityIsReceived=0:r={timesThatSameActivityIsReceived:1},r.lastReceivedId=t.id,r.timesThatSameActivityIsReceived>xplive.Common.MaximunMissingMateUpdatesToConsiderOffline&&t.setAsApparentlyOffline(),e[n]=r},n=function(e,n){var r=e.isApparentlyOffline;e.markedAsOffline=!1,t(e,n),e.isApparentlyOffline&&!r&&(e.markedAsOffline=!0)},r=function(e,t,r){for(var i in e){var s=e[i];s.interpret(i,t.username,r),n(s,i),e[i]=s}},i=function(e){for(var t in e)e[t]=new xplive.Services.MemberActivity(e[t])};this.parseActivity=function(e,t,n){i(e),this._inactivityDetector.discardInactiveUsers(e,this.currentTime),r(e,t,n)}},sOn.EventBus=function(){var e=[];this.addSubscriber=function(t){var n=[].slice.call(arguments).slice(1);e.push({subscriber:t,eventNames:n})},this.emit=function(t,n){for(var r=0,i=e.length;r<i;r++){var s=e[r];for(var o=0,u=s.eventNames.length;o<u;o++)s.eventNames[o]==t&&s.subscriber(t,n)}}};var singleton=new sOn.EventBus;sOn.Factory.ResetEventBus=function(){singleton=new sOn.EventBus},sOn.Factory.EventBus=function(){return singleton},xplive.Services.TeamProxy=function(e){sOn.Interactors.Interactor.call(this,["storage","clock"]);var t=this,n=xplive.Common.InteractWithTeamEvery,r=xplive.Common.ActivityIsSentAtLeast;this.reset=function(){r=0},this._postInitialize=function(){this._clock.start(n)};var i=function(n,r){t._storage.updateUserActivity(e,r)},s=function(e,n){t._storage.updateUserActivity(n.session,n.activity)},o=function(n,i){r>=xplive.Common.ActivityIsSentAtLeast&&(r=0,t._storage.updateUserActivity(e,i))},u=!0,a=function(e,t){u=!1},f=function(e,t){u=!0},l=function(e){sOn.Factory.EventBus().emit(xplive.Events.thereIsNewTeamActivity,e)};this._subscribeEvents=function(){var n=sOn.Factory.EventBus();n.addSubscriber(i,xplive.Events.iHaveChangedMyActivity),n.addSubscriber(o,xplive.Events.iAmDoingTheSameThing),n.addSubscriber(a,xplive.Events.userIsNotInteractingWithWindow),n.addSubscriber(f,xplive.Events.userIsActiveAgain),n.addSubscriber(s,xplive.Events.iAmUpdatingMyMatesActivity),this._clock.onTick=function(n){sOn.Factory.EventBus().emit(xplive.Events.itIsTimeToReviewMyActivity,n),r++,u&&t._storage.retrieveTeamActivity(e,l)}}},xplive.Services.TeamService=function(e){sOn.Interactors.Interactor.call(this,["pomodoroInteractor","tasksService","teamViewer","sleepingPanel","windowCloseDetector","activityHistorian","teamInterpreter"]);var t=this,n=new xplive.Services.MemberActivity,r=function(e,r){var i=t._tasksService.currentTask(),s=xplive.Events.iAmDoingTheSameThing;n.isThereAnyNewActivity(i)&&(s=xplive.Events.iHaveChangedMyActivity,n.resetPomodoroChange()),t.currentTime=r,n.refresh(r,i),sOn.Factory.EventBus().emit(s,n),t._activityHistorian.recordNewActivity(n)},i=function(){n.setAsApparentlyOffline(),sOn.Factory.EventBus().emit(xplive.Events.iHaveChangedMyActivity,n)},s=function(t){for(var n in t)t[n].markedAsOffline&&sOn.Factory.EventBus().emit(xplive.Events.iAmUpdatingMyMatesActivity,{session:{team:e.team,username:n,host:e.host},activity:t[n]})},o=function(n,r){t._teamInterpreter.parseActivity(r,e,t._activityHistorian.getRecentActivity()),s(r),t._teamViewer.updateTeamActivity(r);for(var i in r)i!=e.username&&sOn.Factory.EventBus().emit(xplive.Events.thereIsNewMateActivity,{mate:i,activity:r[i]})};this.whatTheUserCanSeeInTheScreen=function(){return t._teamViewer.html()};var u=function(e,t){n.updatePomodoroActivity(t)},a=function(e,t){n.updatePomodoroActivity(t)},f=function(e,t){n.updatePomodoroActivity(t)},l=function(){t._teamViewer.show(),t._sleepingPanel.hide()},c=function(){t._teamViewer.hide(),t._sleepingPanel.show()};this.onClosing=function(){i()},this._subscribeEvents=function(){var t=sOn.Factory.EventBus();t.addSubscriber(a,xplive.Events.newPomodoroStarted),t.addSubscriber(f,xplive.Events.pomodoroFinished),t.addSubscriber(u,xplive.Events.pomodoroChanged),t.addSubscriber(l,xplive.Events.userIsActiveAgain),t.addSubscriber(c,xplive.Events.userIsNotInteractingWithWindow),t.addSubscriber(r,xplive.Events.itIsTimeToReviewMyActivity),t.addSubscriber(o,xplive.Events.thereIsNewTeamActivity),this._windowCloseDetector.subscribe(this),this._teamViewer.onShowMateInfo=function(n){n!=e.username&&t.emit(xplive.Events.onShowMateInfo,n)}}},xplive.Services.WindowCloseDetector=function(){var e=this,t=function(){e.listener&&e.listener.onClosing()};this.subscribe=function(t){e.listener=t},this.initialize=function(){window.onbeforeunload=t}},xplive.Services.UserActivityDetector=function(){var e=function(){sOn.Factory.EventBus().emit(xplive.Events.userIsNotInteractingWithWindow)},t=function(){sOn.Factory.EventBus().emit(xplive.Events.userIsActiveAgain)},n=function(){sOn.Factory.EventBus().emit(xplive.Events.windowIsVisible)},r=function(){sOn.Factory.EventBus().emit(xplive.Events.windowIsNotVisible)};this.initialize=function(i){$.idleTimer(i||xplive.Common.TimeToConsiderInactivity),$(document).bind("idle.idleTimer",function(){e()}),$(document).bind("active.idleTimer",function(){t()}),Visibility.change(function(e,t){t=="hidden"&&r(),t=="visible"&&n()})},this.reset=function(){$.idleTimer("destroy")}},xplive.Services.MessagesStack=function(){var e=[];this.storeMessage=function(t){e.push(t)},this.popAllMessages=function(){var t=e.slice(0);return e=[],t}},xplive.Services.TeamCommunicator=function(e){sOn.Interactors.Interactor.call(this,["chatProxy","matesWidget","clock","windowManager","soundPlayer","incomingMessagesStack","wholeTeamChatViewer","wholeTeamChatInput"]);var t=this,n=1,r=!1,i=function(e,n){t._matesWidget.updateMateActivity(n.mate,n.activity)},s=!0,o=function(e,n){s=!0,t._windowManager.stopTitleAnimation()},u=function(e,t){s=!1},a=function(e){if(!s){t._windowManager.animateTitle("chat: "+e.sender+" is talking");var n=e.body.substring(0,20)+"...";t._windowManager.popUpNotification(e.sender+" is talking:",n),t._soundPlayer.play()}},f=function(e){e.receiptTime=t._clock.giveMeTheTime(),e.visibleReceiptTime=e.receiptTime.toLocaleTimeString().substring(0,5)},l=function(e){t._matesWidget.moveMessageFromPendingToSent(e.receiver,e)},c=function(){r=!0},h=function(){r=!1;var e=t._incomingMessagesStack.popAllMessages();for(var n=0,i=e.length;n<i;n++)t._matesWidget.showNewMessage(e[n].sender,e[n]);e.length>0&&a(e[0])},p=function(e){t._chatProxy.confirmReception(e),f(e),r?t._incomingMessagesStack.storeMessage(e):(t._matesWidget.showNewMessage(e.sender,e),a(e))},d=function(n,r){r.receiver=n,r.sender=e.username,t._chatProxy.sendMessage(r)},v=function(t,r){var i={body:r,receiver:t,sender:e.username,team:e.team};return i.id=n,n++,f(i),i},m=function(e,n){var r=v(e,n);t._matesWidget.showPendingMessage(e,r),d(e,r)};this._subscribeEvents=function(){sOn.Factory.EventBus().addSubscriber(c,xplive.Events.newPomodoroStarted),sOn.Factory.EventBus().addSubscriber(h,xplive.Events.pomodoroFinished),sOn.Factory.EventBus().addSubscriber(o,xplive.Events.windowIsVisible),sOn.Factory.EventBus().addSubscriber(o,xplive.Events.userIsActiveAgain),sOn.Factory.EventBus().addSubscriber(u,xplive.Events.windowIsNotVisible),sOn.Factory.EventBus().addSubscriber(u,xplive.Events.userIsNotInteractingWithWindow),this._chatProxy.onReceivedMessage=p,this._chatProxy.onConfirmationReceived=l,this._matesWidget.onNewMessageIntroduced=m,sOn.Factory.EventBus().addSubscriber(i,xplive.Events.thereIsNewMateActivity),sOn.Factory.EventBus().addSubscriber(function(e,n){t._matesWidget.showMateInfo(n)},xplive.Events.onShowMateInfo),this._wholeTeamChatInput.focus(),this._wholeTeamChatInput.onEnter=function(){var e=v("team",t._wholeTeamChatInput.text());t._chatProxy.sendMessageToTeam(e),t._wholeTeamChatInput.setText("")},this._chatProxy.onWholeTeamMessage=function(e){t._wholeTeamChatViewer.showMessage(e)}},this._postInitialize=function(){this._chatProxy.connect()},this.sendMessage=function(e){var n={body:e};return{to:function(e){d(e,n),t._matesWidget.showNewMessage(e,n)}}}},xplive.Factory={TasksInteractor:function(e){var t=new xplive.Interactors.Tasks(e.placeholder),n=new sOn.Widgets.Button("taskButton",e.placeholder,"Start new planned task",xplive.Styles.taskStarter),r=new sOn.Widgets.Button("unexpectedTaskButton",e.placeholder,"Start new unexpected task",xplive.Styles.taskStarter);return t.attachTaskButton(n),t.attachUnexpectedTaskButton(r),t.attachTasksBinder(xplive.Factory.TasksBinder(e.placeholder,e.binderDomId)),t.attachFinishedBinder(xplive.Factory.FinishedTasksBinder(e.placeholder,e.finishedBinderDomId)),t.attachExportLauncher(new sOn.Widgets.Button("exportButton",e.placeholder,"Export data (csv)",sOn.Widgets.Button.types.accept)),t.attachExportWidget(new sOn.Widgets.Message("exportWidget",sOn.Widgets.Message.types.success,e.placeholder,"closeExportWidget","exportWidgetContent")),t},TasksBinder:function(e,t){var n=new xplive.DataBinders.Tasks;return n.domId=t,n.attachWidget(new sOn.Widgets.Table(t,e)),n},FinishedTasksBinder:function(e,t){var n=new xplive.DataBinders.Finished;n.domId=t;var r=new sOn.Widgets.Table(t,e);return r.enablePagination(),r.sorting=[[0,"desc"]],r.areColumnsSortable=!0,n.attachWidget(r),n},Pomodoro:function(){var e=new xplive.Clock,t=new xplive.Pomodoro;return t.clock=e,t}},xplive.Factory.TotalsCalculator=function(e,t){var n=new xplive.Interactors.TotalsCalculator,r=new xplive.Widgets.TodayTotals("todayTotalsWidget");return n.attachTodayTotalsWidget(r),n.attachTasksService(e),n.attachPomodoroInteractor(t),n},xplive.Factory.TasksService=function(e,t,n){var r=new xplive.Services.Tasks(t);return n?r.attachInteractor(n):r.attachInteractor(xplive.Factory.TasksInteractor(e)),r.attachStorage(new xplive.Storage.Server),r},xplive.Factory.PomodoroInteractor=function(e){var t=new xplive.Interactors.Pomodoros;t.attachPomodoroLauncher(new sOn.Widgets.Button("pomodoroLauncher",e.placeholder," ",sOn.Widgets.Button.types.accept)),t.attachPomodoroTerminator(new sOn.Widgets.Button("pomodoroTerminator",e.placeholder," ",sOn.Widgets.Button.types.accept)),t.attachProgressBar(new xplive.Widgets.ProgressBar("progressBar",$("#progress")));var n=xplive.Factory.Pomodoro();t.attachPomodoro(n);var r=new sOn.Widgets.TextBox("sizeInMinutesBox",e.placeholder);t.attachSizeInMinutesBox(r),t.attachAlertDialog(new xplive.Widgets.PomodoroPopup),t.attachWindowManager(new xplive.Widgets.WindowManager);var i=new xplive.Widgets.SoundPlayer("/static/meow");return t.attachSoundPlayer(i),t},xplive.Factory.TeamInterpreter=function(){var e=new xplive.Services.TeamInterpreter;return e.attachInactivityDetector(new xplive.Services.InactivityDetector),e},xplive.Factory.TeamProxy=function(e){var t=new xplive.Services.TeamProxy(e);return t.attachStorage(new xplive.Storage.Server),t.attachClock(new xplive.Clock),t},xplive.Factory.TeamService=function(e,t,n){var r=new xplive.Services.TeamService(e);if(t){var i=xplive.Factory.PomodoroInteractor(t);r.attachPomodoroInteractor(i)}return r.attachTeamViewer(new xplive.Widgets.TeamViewer("teamViewer")),n&&r.attachTasksService(xplive.Factory.TasksService(n)),r.attachSleepingPanel(new sOn.Widgets.Panel("sleeping")),r.attachWindowCloseDetector(new xplive.Services.WindowCloseDetector),r.attachActivityHistorian(new xplive.Services.ActivityHistorian),r.attachTeamInterpreter(xplive.Factory.TeamInterpreter()),r},xplive.Factory.TeamCommunicator=function(e,t){t||(t=(new xplive.SessionManager).browserSession());var n=new xplive.Services.TeamCommunicator(t);n.attachChatProxy(new xplive.Chat.ChatProxy(t)),n.attachMatesWidget(new xplive.Widgets.MatesWidget),n.attachClock(new xplive.Clock),n.attachWindowManager(new xplive.Widgets.WindowManager);var r=new xplive.Widgets.SoundPlayer("/static/ring");n.attachSoundPlayer(r),n.attachIncomingMessagesStack(new xplive.Services.MessagesStack),$("#teamChat").draggable({cancel:"textarea,.whole-team-chat"}),$("#teamMonitor").draggable();var i=$("#wholeTeamChat");return n.attachWholeTeamChatViewer(new xplive.Widgets.ChatConversationViewer(i)),n.attachWholeTeamChatInput(new sOn.Widgets.TextArea("wholeTeamChatInput")),n},xplive.Factory.CreateApp=function(e){function f(){this.teamCommunicator=a,this.tasksService=r,this.pomodoroInteractor=i,this.teamService=s,this.tasksInteractor=r.get.interactor,this.totalsCalculator=o,this.teamProxy=n,this.activityDetector=u,this.initialize=function(){this.teamProxy.initialize(),this.tasksService.initialize(),this.pomodoroInteractor.initialize(),this.teamService.initialize(),this.totalsCalculator.initialize(),this.tasksService.loadExistingData(),this.activityDetector.initialize(),this.teamCommunicator.initialize()}}var t=(new xplive.SessionManager).browserSession(),n=xplive.Factory.TeamProxy(t),r=xplive.Factory.TasksService({placeholder:null,binderDomId:e.tasksBinderId,finishedBinderDomId:e.finishedTasksBinderId},t),i=xplive.Factory.PomodoroInteractor({placeholder:null}),s=xplive.Factory.TeamService(t,null,null);s.attachPomodoroInteractor(i),s.attachTasksService(r);var o=xplive.Factory.TotalsCalculator(r,i),u=new xplive.Services.UserActivityDetector,a=xplive.Factory.TeamCommunicator(e);return new f};var AppRouter=Backbone.Router.extend({routes:{dashboard:"index",team:"index",pomodoro:"pomodoro",tasks:"tasks",history:"history",full:"full",settings:"settings"},index:function(){$("#tabs").show(),window.menu.activate("dashboard"),this.tasks()},team:function(){$("#tabs").hide(),window.panels.show("team"),window.menu.activate("team")},pomodoro:function(){window.dashboardTabs.activate("pomodoro"),window.panels.show("pomodoro")},tasks:function(){window.dashboardTabs.activate("tasks"),window.panels.show("tasks")},history:function(){window.dashboardTabs.activate("history"),window.panels.show("finishedTasks")},full:function(){window.dashboardTabs.activate("full"),window.panels.showAllBut("team"),window.panels.hide("settings")},settings:function(){window.dashboardTabs.activate("settings"),window.panels.show("settings")}});window.startPage=function(){xplive.App=xplive.Factory.CreateApp({tasksPlaceholder:null,tasksBinderId:"tasks",finishedTasksBinderId:"finishedTasks",pomodorosPlaceholder:null}),xplive.App.initialize(),window.dashboardTabs=new xplive.Widgets.ExclusiveButtonToolbar,window.dashboardTabs.addButtons({tasks:"tasksTab",pomodoro:"pomodoroTab",history:"historyTab",full:"fullTab",settings:"settingsTab"}),window.menu=new xplive.Widgets.ExclusiveButtonToolbar,window.menu.addButtons({dashboard:"dashboardMenu",team:"teamMenu"}),window.panels=new xplive.Widgets.ExclusivePanelList,window.panels.addPanels({pomodoro:"pomodorosPage",tasks:"tasksPanel",finishedTasks:"finishedTasksPanel",team:"teamPage",settings:"settingsPage"}),xplive.UItext.TASKS_MONITOR_TITLE="{{TASKS_MONITOR_TITLE}}";try{var e=new sOn.Widgets.Checkbox("confChatPopUpAlert");e.initialize(),e.onChange=function(){window.webkitNotifications.requestPermission(function(){})}}catch(t){}window.readyForTestRunner=!0},$(document).ready(function(){startPage&&startPage();var e=new AppRouter;Backbone.history.start()});