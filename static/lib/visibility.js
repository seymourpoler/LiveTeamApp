(function(e){"use strict";var t=function(t){return t!=e};var n=window.Visibility={onVisible:function(e){if(!n.isSupported()||!n.hidden()){e();return n.isSupported()}var t=n.change(function(r,i){if(!n.hidden()){n.unbind(t);e()}});return t},change:function(e){if(!n.isSupported()){return false}n._lastCallback+=1;var t=n._lastCallback;n._callbacks[t]=e;n._setListener();return t},unbind:function(e){delete n._callbacks[e]},afterPrerendering:function(e){if(!n.isSupported()||"prerender"!=n.state()){e();return n.isSupported()}var t=n.change(function(r,i){if("prerender"!=i){n.unbind(t);e()}});return t},hidden:function(){return n._prop("hidden",false)},state:function(){return n._prop("visibilityState","visible")},isSupported:function(){return t(n._prefix())},_doc:window.document,_prefixes:["webkit","moz"],_chechedPrefix:null,_listening:false,_lastCallback:-1,_callbacks:{},_hiddenBefore:false,_init:function(){n._hiddenBefore=n.hidden()},_prefix:function(){if(null!==n._chechedPrefix){return n._chechedPrefix}if(t(n._doc.visibilityState)){return n._chechedPrefix=""}var e;for(var r=0;r<n._prefixes.length;r++){e=n._prefixes[r]+"VisibilityState";if(t(n._doc[e])){return n._chechedPrefix=n._prefixes[r]}}},_name:function(e){var t=n._prefix();if(""==t){return e}else{return t+e.substr(0,1).toUpperCase()+e.substr(1)}},_prop:function(e,t){if(!n.isSupported()){return t}return n._doc[n._name(e)]},_onChange:function(e){var t=n.state();for(var r in n._callbacks){n._callbacks[r].call(n._doc,e,t)}n._hiddenBefore=n.hidden()},_setListener:function(){if(n._listening){return}var e=n._prefix()+"visibilitychange";var t=function(){n._onChange.apply(Visibility,arguments)};if(n._doc.addEventListener){n._doc.addEventListener(e,t,false)}else{n._doc.attachEvent(e,t)}n._listening=true;n._hiddenBefore=n.hidden()}};n._init()})()